!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.cropduster=t():e.cropduster=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="callbacks are deprecated in cropduster, prefer using promises for asynchronous operations",o={CORS_PROXY_SERVER:"http://cors.movableink.com",$:function(e,t){return t||(t=document),Array.prototype.slice.call(t.querySelectorAll(e))},_initParams:function(){o._urlParams={};for(var e=/([^&=]+)=?([^&]*)/g,t=o._searchString(),n=e.exec(t);n;)o._urlParams[decodeURIComponent(n[1])]=decodeURIComponent(n[2]),n=e.exec(t)},param:function(e){return o.params()[e]},params:function(e){var t=o._urlParams;return void 0===t&&(o._initParams(),t=o._urlParams),e?t[e]:t},_searchString:function(){return window.location.search.substring(1)},autofill:function(){o.param("init");var e=o._urlParams;for(var t in e)"undefined"!==e[t]&&e[t].length>0&&document.getElementById("autofill_"+t)&&(document.getElementById("autofill_"+t).innerHTML=e[t])},throwError:function(e){"undefined"==typeof MICapture?o.log("Capturama error: "+e):MICapture.error(e)},cancelRequest:function(e){"undefined"==typeof MICapture?o.log("Request canceled: "+e):MICapture.cancel(e)},setImageRedirect:function(e){var t=document.getElementById("mi-redirect-image")||document.createElement("a");return t.href=e,t.id="mi-redirect-image",t.style.display="none",document.body.appendChild(t),t},setClickthrough:function(e){var t=document.getElementById("mi_dynamic_link")||document.createElement("a");return t.href=e,t.id="mi_dynamic_link",t.style.display="none",document.body.appendChild(t),t},setExtraData:function(e){var t=document.getElementById("mi-data")||document.createElement("div");t.id="mi-data",t.style.display="none";var n=void 0;try{n=JSON.parse(t.getAttribute("data-mi-data"))||{}}catch(e){n={}}for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return t.setAttribute("data-mi-data",JSON.stringify(n)),document.body.appendChild(t),t},proxyUrl:function(e){var t=document.createElement("a");t.href=e;var n="";n="0"===t.port||""===t.port?"https:"===t.protocol?":443":"":":"+t.port;var r=t.hostname,a=t.pathname,u=t.search,i=t.hash;return o.CORS_PROXY_SERVER+"/"+r+n+a+u+i},_readyToCapture:!0,_reset:function(){o._readyToCapture=!0},pause:function(e,t){t=t||"manual suspension",e&&(t+=", will end in "+e+"ms",setTimeout(function(){MICapture.resume(t)},e)),"undefined"==typeof MICapture?o.log("paused: "+t):MICapture.pause(t)},resume:function(e){"undefined"==typeof MICapture?o.log("resuming paused capture: "+e):MICapture.resume(e)},getCORS:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};return"function"==typeof t&&(n=t,t={}),t.corsCacheTime=t.corsCacheTime||1e4,/cors.movableink.com/.test(e)||(e=o.proxyUrl(e)),t.headers=t.headers||{},t.headers["x-reverse-proxy-ttl"]=t.corsCacheTime/1e3,t.headers["x-mi-cbe"]=this._hashForRequest(e,t),o.get(e,t,n)},get:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};"function"==typeof t&&(n=t,t={});var a=function(){if(n&&"function"==typeof n)return o.log(r),n.apply(void 0,arguments)},u="xhr: "+e;return new Promise(function(n,r){try{var i=new XMLHttpRequest;if(i.onerror=function(){o.resume(u),o.log("XHR error for "+e),a(null),r({status:this.status,statusText:i.statusText})},i.onload=function(){o.resume(u);var e=this.getResponseHeader("content-type"),t=this.responseText,r=this.status;a(t,r,e),n({contentType:e,data:t,status:r})},i.open(t.method||"GET",e,!0),i.withCredentials=!0,t.headers)for(var s in t.headers)i.setRequestHeader(s,t.headers[s]);i.send(t.body),o.pause(t.maxSuspension,u)}catch(e){a(null),r({message:"Cropduster failed to create Promise: "+e,error:e})}})},getImage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};"function"==typeof t&&(n=t,t={});var a=function(){if(n&&"function"==typeof n)return o.log(r),n.apply(void 0,arguments)},u="getImage: "+e;return new Promise(function(n,r){var i=new Image;i.onload=function(){o.resume(u),a(i),n(i)},i.onerror=function(e){o.resume(u),a(null),r(e)},o.pause(t.maxSuspension,u),i.src=e})},getImages:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this,a=arguments[2],u=arguments[3],i="getImages:";o.pause(t.maxSuspension,i),"function"==typeof t&&(u=a,a=t,t={});var s=e.map(function(e){return n.getImage(e,t.maxSuspension).then(function(e){return a&&a(e),e})});return Promise.all(s).then(function(e){return u&&(o.log(r),u(e)),o.resume(i),e},function(e){throw o.resume(i),new Error("Not all images loaded successfully")})},waitForAsset:function(e){"undefined"==typeof MICapture?o.log("Wait for asset: "+e):MICapture.waitForAsset(e)},log:function(e){console.log(e)},_hashForRequest:function(e,t){var n=""+e+JSON.stringify(t),r=0;if(0===n.length)return r;for(var o=0;o<n.length;o++)r=(r<<5)-r+n.charCodeAt(o)&4294967295;return r.toString()}};t.default=o,e.exports=t.default}])});
//# sourceMappingURL=cropduster.js.map