!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.cropduster=t():e.cropduster=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,r){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a="callbacks are deprecated in cropduster, prefer using promises for asynchronous operations",u={CORS_PROXY_SERVER:"http://cors.movableink.com",$:function(e,t){return t||(t=document),[].concat(n(t.querySelectorAll(e)))},_initParams:function(){u._urlParams={};for(var e=/([^&=]+)=?([^&]*)/g,t=u._searchString(),r=e.exec(t);r;)u._urlParams[decodeURIComponent(r[1])]=decodeURIComponent(r[2]),r=e.exec(t)},param:function(e){return u.params()[e]},params:function(e){var t=u._urlParams;return void 0===t&&(u._initParams(),t=u._urlParams),e?t[e]:t},_searchString:function(){return window.location.search.substring(1)},autofill:function(){u.param("init");var e=u._urlParams;for(var t in e)"undefined"!==e[t]&&e[t].length>0&&document.getElementById("autofill_"+t)&&(document.getElementById("autofill_"+t).innerHTML=e[t])},throwError:function(e){u.miCaptureFallback(function(){MICapture.error(e)},function(){u.log("Capturama error: "+e)})},cancelRequest:function(e){u.miCaptureFallback(function(){MICapture.cancel(e)},function(){u.log("Request canceled: "+e)})},setImageRedirect:function(e){var t=document.getElementById("mi-redirect-image")||document.createElement("a");return t.href=e,t.id="mi-redirect-image",t.style.display="none",document.body.appendChild(t),t},setClickthrough:function(e){var t=document.getElementById("mi_dynamic_link")||document.createElement("a");return t.href=e,t.id="mi_dynamic_link",t.style.display="none",document.body.appendChild(t),t},setExtraData:function(e){var t=document.getElementById("mi-data")||document.createElement("div");t.id="mi-data",t.style.display="none";var r=void 0;try{r=JSON.parse(t.getAttribute("data-mi-data"))||{}}catch(e){r={}}for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return t.setAttribute("data-mi-data",JSON.stringify(r)),document.body.appendChild(t),t},proxyUrl:function(e){var t=document.createElement("a");t.href=e;var r="";r="0"===t.port||""===t.port?"https:"===t.protocol?":443":"":":"+t.port;var n=t.hostname,o=t.pathname,a=t.search,i=t.hash;return u.CORS_PROXY_SERVER+"/"+n+r+o+a+i},_readyToCapture:!0,_reset:function(){u._readyToCapture=!0},pause:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"manual suspension";e&&(t+=", will end in "+e+"ms",setTimeout(function(){u.resume(t)},e)),u.miCaptureFallback(function(){MICapture.pause(t)},function(){u.log("paused: "+t)})},resume:function(e){u.miCaptureFallback(function(){MICapture.resume(e)},function(){u.log("resuming paused capture: "+e)})},getCORS:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2];return"function"==typeof t&&(r=t,t={}),t.corsCacheTime=t.corsCacheTime||1e4,/cors.movableink.com/.test(e)||(e=u.proxyUrl(e)),t.headers=t.headers||{},t.headers["x-reverse-proxy-ttl"]=t.corsCacheTime/1e3,t.headers["x-mi-cbe"]=this._hashForRequest(e,t),u.get(e,t,r)},get:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2];"function"==typeof t&&(r=t,t={});var n=function(){if(r&&"function"==typeof r)return u.log(a),r.apply(void 0,arguments)},o="xhr: "+e;return new Promise(function(r,a){try{var i=new XMLHttpRequest;if(i.onerror=function(){var t="XHR error for "+e+" - "+this.status+": "+this.statusText;u.resume(o),n(null),a(new Error(t))},i.onload=function(){var e=this.getResponseHeader("content-type"),t=this.responseText,a=this.status;if(a>=400)return this.onerror();u.resume(o),n(t,a,e),r({contentType:e,data:t,status:a})},i.open(t.method||"GET",e,!0),i.withCredentials=!0,t.headers)for(var c in t.headers)i.setRequestHeader(c,t.headers[c]);i.send(t.body),u.pause(t.maxSuspension,o)}catch(e){n(null),a({message:"Cropduster failed to create Promise: "+e,error:e})}})},getImage:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2];"function"==typeof t&&(r=t,t={});var n=function(){if(r&&"function"==typeof r)return u.log(a),r.apply(void 0,arguments)},o="getImage: "+e;return new Promise(function(r,a){var i=new Image;i.onload=function(){u.resume(o),n(i),r(i)},i.onerror=function(e){u.resume(o),n(null),a(e)},u.pause(t.maxSuspension,o),i.src=e})},getImages:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this,n=arguments[2],o=arguments[3],i="getImages:";u.pause(t.maxSuspension,i),"function"==typeof t&&(o=n,n=t,t={});var c=e.map(function(e){return r.getImage(e,t.maxSuspension).then(function(e){return n&&n(e),e})});return Promise.all(c).then(function(e){return o&&(u.log(a),o(e)),u.resume(i),e},function(e){throw u.resume(i),new Error("Not all images loaded successfully")})},waitForAsset:function(e){u.miCaptureFallback(function(){MICapture.waitForAsset(e)},function(){u.log("Wait for asset: "+e)})},log:function(e){console.log(e)},miCaptureFallback:function(e,t){return!window.MICapture||"object"!==o(window.MICapture)?t():e()},_hashForRequest:function(e,t){var r=""+e+JSON.stringify(t),n=0;if(0===r.length)return n;for(var o=0;o<r.length;o++)n=(n<<5)-n+r.charCodeAt(o)&4294967295;return n.toString()}};t.default=u}])});
//# sourceMappingURL=cropduster.js.map